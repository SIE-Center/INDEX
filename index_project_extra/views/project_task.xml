<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="task_index_extra_fields_form" model="ir.ui.view">
        <field name="name">project.task.index.fields</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="arch" type="xml">
        <xpath expr="//page[@name='description_page']" position="before">
        <!--Reporte SMC IMMEX-->
            <page name="report_lines" string="Reporte SMC IMMEX">
                    <field name="stage_seq" invisible = "1"/>
                    <field name="custom_task_line_ids" attrs="{'readonly': [('stage_seq', '!=', 0)]}">
                        <tree>
                            <field name="custom_category"/>
                            <field name="bl"/>
                            <field name="container_number"/>
                            <field name="agente_aduanal"/>
                            <field name="naviera"/>
                            <field name="forwarders"/>
                            <field name="operadora"/>
                            <field name="buque"/>
                            <field name="numero_viaje"/>
                            <field name="eta_date" optional = "hide" />
                            <field name="previo_date" optional = "hide" />
                            <field name="dispatch_date" optional = "hide" />
                            <field name="peso" optional = "hide" />
                            <field name="pieza" optional = "hide" />
                            <field name="container_type_id" optional = "hide" />
                            <field name="service_type_id" optional = "hide" />
                            <field name="packing_type_id" optional = "hide" />
                            <field name="transportista" optional = "hide" />
                        </tree>
                    </field>
                </page>
        <!--Pestaña de Validaciones-->
            <page name="Validations" string="Flujo de Validaciones">
                    <field name="valida_ids"  ><!--Agregar read only al terminar las pruebas-->
                        <tree string ="Flujo de Validaciones"  editable="bottom" create="0" delete="0">
                            <field name="custom_category" invisible = "1"/>
                            <field name="container_number" readonly = "1"/>
                            <field name="etapa" readonly = "1"/>
                            <!--Forwarder-->
                            <field name="u_forwarder" attrs="{'invisible': [('etapa', '!=', '1')]}" readonly = "1"/>
                            <field name="vfdocs" attrs="{'invisible': [('etapa', '!=', '1')]}" groups = "index_project_extra.group_Forwarder_auth"/>   
                            <field name="vflete" attrs="{'invisible': [('etapa', '!=', '1')]}" groups = "index_project_extra.group_Forwarder_auth"/>   
                            <button name="val_forwarder" string="Forwarder"   class="oe_highlight" type="object" attrs="{'invisible': [('etapa', '!=', '1')]}" groups = "index_project_extra.group_Forwarder_auth"/>
                            <!--Agente Aduanal-->
                            <field name="u_aduanal" attrs="{'invisible': [('etapa', '!=', '2')]}" readonly = "1" groups = "index_project_extra.group_agente_auth"/>
                            <field name="vdt_revalida" attrs="{'invisible': [('etapa', '!=', '2')]}"  groups = "index_project_extra.group_agente_auth"/>    
                            <field name="vdt_folio"  attrs="{'invisible': ['|',('etapa', '!=', '2'),('custom_category', '!=', '24')]}"  groups = "index_project_extra.group_agente_auth"/>
                            <field name="vdt_previo" attrs="{'invisible': ['|',('etapa', '!=', '2'),('custom_category', '!=', '36')]}"  groups = "index_project_extra.group_agente_auth"/>
                            <button name="val_aduanal" string="Aduanal"        class="oe_highlight" type="object" attrs="{'invisible': [('etapa', '!=', '2')]}"  groups = "index_project_extra.group_agente_auth"/>
                            <!--Transportista-->       
                            <field name="u_transportista" attrs="{'invisible': [('etapa', '!=', '3')]}" readonly = "1"  groups = "index_project_extra.group_trans_auth"/>  
                            <field name="vtplaca" attrs="{'invisible': [('etapa', '!=', '3')]}" groups = "index_project_extra.group_trans_auth"/>       
                            <field name="vtconductor" attrs="{'invisible': [('etapa', '!=', '3')]}" groups = "index_project_extra.group_trans_auth"/>   
                            <button name="val_transportista" string="Transportista"   class="oe_highlight" type="object" attrs="{'invisible': [('etapa', '!=', '3')]}" groups = "index_project_extra.group_trans_auth"/>
                            <!--Maniobras-->        
                            <field name="vdt_maniobra" attrs="{'invisible': [('etapa', '!=', '4')]}"/>   
                            <button name="val_maniobras" string="Maniobras"   class="oe_highlight" type="object" attrs="{'invisible': [('etapa', '!=', '4')]}" groups = "index_project_extra.group_agente_auth"/>
                            <!--Fecha Eta-->
                            <field name="eta_date" groups = "index_project_extra.group_master_auth" />
                            <button name="reset"    string="Reinicio"   class="oe_highlight" type="object" groups = "index_project_extra.group_master_auth"/>
                            <button name="baja"     string="Baja"       class="oe_highlight" type="object" groups = "index_project_extra.group_master_auth"/>
                        </tree>
                    </field>
                </page>

        </xpath>
        <xpath expr="//page[@name='report_lines']" position="after">
            <page name="Index" string="Index">
                <!--Validación Index-->
                <group name="Index" string="Validación Index" col="6" >
                    <button name="val_index"        string="Validación Index"  groups = "index_project_extra.group_index_auth"         class="oe_highlight" type="object" attrs="{'invisible': ['|',('stage_seq', '!=', 0),('active','=',False)]} "/>
                    <field name="viuser_id" readonly = '1'/>
                    <field name="vidate" readonly = '1'/>
                </group>
                <!--Validación Control del Flujo-->  
            <group name="Control de Tareas" string="Control del Flujo" col="4" >
                    <button name="baja_index"        string="Baja"          groups = "index_project_extra.group_master_auth" class="oe_highlight" type="object" attrs="{'invisible': [('active','=',False)]}"/>
                    <button name="alta_index"        string="Alta"          groups = "index_project_extra.group_master_auth" class="oe_highlight" type="object" attrs="{'invisible': [('active','=',True)]} "/>
                    <button name="reset_index"       string="Reinicio"      groups = "index_project_extra.group_master_auth" class="oe_highlight" type="object" attrs="{'invisible': [('active','=',False)]} "/>
                    <button name="fin_index"         string="Finalizada"    groups = "index_project_extra.group_master_auth" class="oe_highlight" type="object" attrs="{'invisible': [('active','=',False)]} "/>
            </group>
            </page>
        </xpath>
        <!--No se permite pasar de seccion libremente-->
        <xpath expr="//field[@name='stage_id']" position="replace">
            <field name="stage_id" widget="statusbar"  attrs="{'invisible': [('project_id', '=', False), ('stage_id', '=', False)]} " readonly = '1' />
        </xpath>
        <!-- Boton de Validación de Datos -->
        <xpath expr="//field[@name='user_ids']" position="after">
            <button name="data_validation" string="Verificación de Datos" class="oe_highlight" type="object" attrs="{'invisible': ['|',('data_ok', '=', True),('active','=',False)]} "/>
        </xpath>
        
        <!--Reemplazo de Etiqueta por IMMEX-->
        <xpath expr="//field[@name='partner_id']" position="replace">
            <field name="partner_id" widget="res_partner_many2one" class="o_task_customer_field" string = "IMMEX"/>
        </xpath>
        <!--Correo Enviado-->
        <xpath expr="//field[@name='tag_ids']" position="after">
            <field name="data_ok" string ='Datos Verificados' readonly ="1"/>
        </xpath>
        </field>
    </record>
</odoo>